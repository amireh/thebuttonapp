<% content_for :deferred_js do %>
  <script>
    $(function() {
      $( "#from" ).datepicker({
        defaultDate: "+1w",
        inline: false,
        changeMonth: true,
        numberOfMonths: 1,
        onClose: function( selectedDate ) {
          $( "#to" ).datepicker( "option", "minDate", selectedDate );
        }
      });
      $( "#to" ).datepicker({
        defaultDate: "+1w",
        changeMonth: true,
        numberOfMonths: 1,
        onClose: function( selectedDate ) {
          $( "#from" ).datepicker( "option", "maxDate", selectedDate );
        }
      });

      $("#generate_report input[type=radio]").change(function() {
        if ($(this).parent().find(":checked").attr("value") == 'custom')
          $("#report_date_selector").show();
        else
          $("#report_date_selector").hide();
      });
    });
  </script>
<% end %>

<% content_for :subtitle do %>Generate a report<% end %>

<form method="POST" id="generate_report" action="/reports">
  <section>
    <h3>Choose a period</h3>
    <p>
      <label>
        <input type="radio" name="date[range]" value="current_month" checked="checked">Current month (<%= Time.now.strftime('%B') %>)</option>
      </label><br />
      <label>
        <input type="radio" name="date[range]" value="current_year">Current year (<%= Time.now.strftime('%Y') %>)</option>
      </label><br />
      <label>
        <input type="radio" name="date[range]" value="last_month">Last month (<%= 1.month.ago.strftime('%B') %>)</option>
      </label><br />
      <label>
        <input type="radio" name="date[range]" value="last_year">Last year (<%= 1.year.ago.strftime('%Y') %>)</option>
      </label><br />
      <label>
        <input type="radio" name="date[range]" value="custom">Custom</option>
      </label>
      <div class="hidden" id="report_date_selector">
          <label>From: <input type="text" name="date[from]" id="from" /></label>
          <label>To: <input type="text" name="date[to]" id="to" /></label>
        </div>
    </p>
  </section>
  <section>
    <h3>Filter</h3>
    <% @user.tags.each do |tag| %>
      <label><input type="checkbox" value="<%= tag.id %>" name="tags[]" /><%= tagify("##{tag.name}") %></label>
    <% end %>
  </section>
  <br />
  <input type="submit" value="Generate" />
</form>