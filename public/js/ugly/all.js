(function(e){e.fn.jqm=function(r){var i={overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:s,ajaxText:"",target:s,modal:s,toTop:s,onShow:s,onHide:s,onLoad:s};return this.each(function(){if(this._jqm)return n[this._jqm].c=e.extend({},n[this._jqm].c,r);t++,this._jqm=t,n[t]={c:e.extend(i,e.jqm.params,r),a:s,w:e(this).addClass("jqmID"+t),s:t},i.trigger&&e(this).jqmAddTrigger(i.trigger)})},e.fn.jqmAddClose=function(e){return c(this,e,"jqmHide")},e.fn.jqmAddTrigger=function(e){return c(this,e,"jqmShow")},e.fn.jqmShow=function(t){return this.each(function(){t=t||window.event,e.jqm.open(this._jqm,t)})},e.fn.jqmHide=function(t){return this.each(function(){t=t||window.event,e.jqm.close(this._jqm,t)})},e.jqm={hash:{},open:function(t,o){var a=n[t],l=a.c,c="."+l.closeClass,h=parseInt(a.w.css("z-index")),h=h>0?h:3e3,p=e("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":h-1,opacity:l.overlay/100});if(a.a)return s;a.t=o,a.a=!0,a.w.css("z-index",h),l.modal?(r[0]||f("bind"),r.push(t)):l.overlay>0?a.w.jqmAddClose(p):p=s,a.o=p?p.addClass(l.overlayClass).prependTo("body"):s;if(i){e("html,body").css({height:"100%",width:"100%"});if(p){p=p.css({position:"absolute"})[0];for(var d in{Top:1,Left:1})p.style.setExpression(d.toLowerCase(),"(_=(document.documentElement.scroll"+d+" || document.body.scroll"+d+"))+'px'")}}if(l.ajax){var v=l.target||a.w,m=l.ajax,v=typeof v=="string"?e(v,a.w):e(v),m=m.substr(0,1)=="@"?e(o).attr(m.substring(1)):m;v.html(l.ajaxText).load(m,function(){l.onLoad&&l.onLoad.call(this,a),c&&a.w.jqmAddClose(e(c,a.w)),u(a)})}else c&&a.w.jqmAddClose(e(c,a.w));return l.toTop&&a.o&&a.w.before('<span id="jqmP'+a.w[0]._jqm+'"></span>').insertAfter(a.o),l.onShow?l.onShow(a):a.w.show(),u(a),s},close:function(t){var i=n[t];return i.a?(i.a=s,r[0]&&(r.pop(),r[0]||f("unbind")),i.c.toTop&&i.o&&e("#jqmP"+i.w[0]._jqm).after(i.w).remove(),i.c.onHide?i.c.onHide(i):(i.w.hide(),i.o&&i.o.remove()),s):s},params:{}};var t=0,n=e.jqm.hash,r=[],i=e.browser.msie&&e.browser.version=="6.0",s=!1,o=e('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),u=function(t){i&&(t.o?t.o.html('<p style="width:100%;height:100%"/>').prepend(o):e("iframe.jqm",t.w)[0]||t.w.prepend(o)),a(t)},a=function(t){try{e(":input:visible",t.w)[0].focus()}catch(n){}},f=function(t){e()[t]("keypress",l)[t]("keydown",l)[t]("mousedown",l)},l=function(t){var i=n[r[r.length-1]],s=!e(t.target).parents(".jqmID"+i.s)[0];return s&&a(i),!s},c=function(t,r,i){return t.each(function(){var t=this._jqm;e(r).each(function(){this[i]||(this[i]=[],e(this).click(function(){for(var e in{jqmShow:1,jqmHide:1})for(var t in this[e])n[this[e][t]]&&n[this[e][t]].w[e](this);return s})),this[i].push(t)})})}})(jQuery);shortcut={all_shortcuts:{},add:function(e,t,n){var r={type:"keydown",propagate:!1,disable_in_input:!1,target:document,keycode:!1};if(!n)n=r;else for(var i in r)typeof n[i]=="undefined"&&(n[i]=r[i]);var s=n.target;typeof n.target=="string"&&(s=document.getElementById(n.target));var o=this;e=e.toLowerCase();var u=function(r){r=r||window.event;if(n.disable_in_input){var i;r.target?i=r.target:r.srcElement&&(i=r.srcElement),i.nodeType==3&&(i=i.parentNode);if(i.tagName=="INPUT"||i.tagName=="TEXTAREA")return}r.keyCode?code=r.keyCode:r.which&&(code=r.which);var s=String.fromCharCode(code).toLowerCase();code==188&&(s=","),code==190&&(s=".");var o=e.split("+"),u=0,a={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},f={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},l={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};r.ctrlKey&&(l.ctrl.pressed=!0),r.shiftKey&&(l.shift.pressed=!0),r.altKey&&(l.alt.pressed=!0),r.metaKey&&(l.meta.pressed=!0);for(var c=0;k=o[c],c<o.length;c++)k=="ctrl"||k=="control"?(u++,l.ctrl.wanted=!0):k=="shift"?(u++,l.shift.wanted=!0):k=="alt"?(u++,l.alt.wanted=!0):k=="meta"?(u++,l.meta.wanted=!0):k.length>1?f[k]==code&&u++:n.keycode?n["keycode"]==code&&u++:s==k?u++:a[s]&&r.shiftKey&&(s=a[s],s==k&&u++);if(u==o.length&&l.ctrl.pressed==l.ctrl.wanted&&l.shift.pressed==l.shift.wanted&&l.alt.pressed==l.alt.wanted&&l.meta.pressed==l.meta.wanted){t(r);if(!n.propagate)return r.cancelBubble=!0,r.returnValue=!1,r.stopPropagation&&(r.stopPropagation(),r.preventDefault()),!1}};this.all_shortcuts[e]={callback:u,target:s,event:n.type},s.addEventListener?s.addEventListener(n.type,u,!1):s.attachEvent?s.attachEvent("on"+n.type,u):s["on"+n.type]=u},remove:function(e){e=e.toLowerCase();var t=this.all_shortcuts[e];delete this.all_shortcuts[e];if(!t)return;var n=t.event,r=t.target,i=t.callback;r.detachEvent?r.detachEvent("on"+n,i):r.removeEventListener?r.removeEventListener(n,i,!1):r["on"+n]=!1}};var $,jQuery;if(!$&&!jQuery)throw"jQuery could not be found, dynamism requires it.";dynamism=function(e){function u(){e.debug||(o=function(e,t){return!t||t=="D"?!1:s("["+t+"] "+e)});if(e.log_target){var t=e.log_target.html("<ol></ol>").find("ol:first");s=function(e){var n=e.substr(1,1);t.append("<li class='"+n+"'><em>"+n+"</em> "+e.substr(4)+"</li>")}}e.logging||(s=function(){})}function c(e){typeof e=="string"&&(e=[e]);var t="";for(var n=0;n<e.length;++n){if(!e[n]||e[n]=="")continue;t+="["+e[n]+"]"}return $.escape(t)}function h(e){var t=e.split(".");if(t.length==0&&!window[e])return null;var n=window[t[0]];for(var r=1;r<t.length;++r){if(!n)return null;n=n[t[r]]}return n}function p(e){var t=null,n=$(e).attr("data-dyn-target"),r=$(e).attr("data-dyn-target-index");if(!n){var i=$(e).parents("[data-dyn-entity]:not([data-dyn-index=-1]):first");if(i.length==0)return o("Unable to find any parent entity for: "+a(e),"E"),null;t=i}return t=t||$("[data-dyn-entity='"+$.escape(n)+"']"+"[data-dyn-index="+r+"]"),t.length==0?(o("Target could not be located by: "+a(e),"E"),null):t}function d(e,t,n,r){var i=r.length>0?r.join(".")+"."+e:e;i=$.escape(i);var s=n.find("[data-dyn-inject]:visible,input[data-dyn-inject][type=hidden]");n.attr("data-dyn-inject")&&(o("Self-object wants to be injected too! "+n.attr("data-dyn-inject"),"N"),s=s.add(n)),s=s.filter(function(){return $(this).attr("data-dyn-inject").trim().match(RegExp("@\\S+,\\s*"+i))}),s.each(function(){var r=$(this),s=r.attr("data-dyn-inject").trim().split(/,\s*/);if(s.length%2!=0)return alert("Syntax error: "+s.join(" ")+" are not even!"),!1;for(var u=0;u<s.length;u+=2){if(s[u+1]!=i){r.is(n)&&o("Self is not interested in "+s[u+1]);continue}if(m(r,s[u],i)){o("this element has already been injected with "+s[u]+" for "+i+", skipping","N");continue}var a=s[u].substr(1);if(a=="text")r.html().search("%"+e)!=-1?r.html(r.html().replace(RegExp("%"+e,"g"),t)):r.html(t);else{var f=r.attr(a);if(f&&f.search("%"+e)!=-1){var l=RegExp("%"+e,"g");r.attr(a,f.replace(l,t))}else r.attr(a,t)}g(r,"@"+a,i)}}),s.length==0&&o("Could not find any entity referencing: "+i,"E")}function v(e,t){return e+" "+t}function m(e,t,n){for(var i=0;i<r.length;++i){var s=r[i];if(e.is(s.o)&&s.injections.search(v(t,n))!=-1)return!0}return!1}function g(e,t,n){var i=!1;for(var s=0;s<r.length;++s){var u=r[s];if(e.is(u.o)){u.injections+=v(t,n),i=!0;break}}i||r.push({o:e,injections:v(t,n)}),o("Injection: "+n+" into "+t+" on "+a(e))}function y(e){for(var n=0;n<t.length;++n)if(t[n]==e)return!0;return!1}function b(){var e=$(this);if(!e.attr("data-dyn-hook").match(/\s*\S+,\s*\S+/))return o("hooks: invalid syntax, unable to parse event or method in: "+e.attr("data-dyn-hook"),"E"),!1;var t=e.attr("data-dyn-hook").trim().split(/,\s*/);if(t.length%2!=0)return o("hooks: invalid syntax, odd number of event<->method pairs in: "+e.attr("data-dyn-hook"),"E"),!1;var n=function(e,t){return function(n){return n.is(e)?t.apply(n,arguments):!0}},r=t.length;for(var i=0;i<r;i+=2){var s=t[i],u=t[i+1],a=h(u);typeof u=="string"&&a&&typeof a=="function"?y(s)?dynamism.add_callback(n(e,a),s):(o("hooks: binding window event: "+s+" => "+u),e.bind(s,a)):o("hooks: Invalid event or method: "+s+" => "+u,"E")}e.attr("data-dyn-hook",null)}var t=["all","addition","removal","post-removal","post-injection"],n={},r=[],i={},e=$.extend({debug:!0,logging:!0,log_target:null,log_out:null},e);$.apply_on=function(e,t){$(e).each(function(){t($(this))})};var s=function(e){console.log(e)},o;o=function(e,t){t=t||"D",s("["+t+"] "+e)};var a;a||(a=function(e){var t=$(e)[0],n="<"+t.tagName;if(t.attributes)for(var r=0;r<t.attributes.length;++r){var i=t.attributes[r];n+=" "+i.name+'="'+i.value+'"'}return n+=" />",n});var f;f||(f=function(e,t){e=e||[];for(var n=0;n<e.length;++n)t(e[n])}),f(t,function(e){n[e]=[]}),$.escape=function(e){return e.replace(/\[/g,"\\[").replace(/\]/g,"\\]")};var l=$.escape;return{configure:function(t){e=$.extend(e,t),u()},callbacks:n,add:function(e){var t=null,r=null;if(e)try{e=$(e),t=e.attr("data-dyn-entity"),r=e.attr("data-dyn-index");if(!t||!r)throw"Invalid target, has no identity or index"}catch(i){o(i),e=null}if(!e){t=$(this).attr("data-dyn-target"),r=$(this).attr("data-dyn-target-index")||-1,e=$("[data-dyn-entity='"+$.escape(t)+"']"+"[data-dyn-index="+r+"]");if(e.length==0)return o("Unable to find entity. Invalid reference by: "+a($(this))),!1}var s=$("[data-dyn-entity='"+$.escape(t)+"']:last"),u=parseInt(s.attr("data-dyn-index"))+1,c=e.clone();c.attr({hidden:null,"data-dyn-index":u});var h=RegExp(l(t+"[-1]"),"g"),p=t+"["+u+"]";return c.find("*").each(function(){var e=$(this);$.each(e.get(0).attributes,function(t,n){try{e.attr(n.name,n.value.replace(h,p))}catch(r){}}),e.attr("data-dyn-target")==t&&(e.attr("data-dyn-inject")=="index"&&e.html(u),e.attr("data-dyn-target-index",u))}),c.find("[data-dyn-inject=index]:not([data-dyn-target])").each(function(){var e=$(this);e.parents("[data-dyn-entity]:first").attr("data-dyn-entity")==c.attr("data-dyn-entity")&&e.html(u)}),dynamism.bind(c),$("[data-dyn-entity="+$.escape(t)+"]:last").after(c),f(n.addition,function(e){e(c)}),f(n.all,function(e){e(c,"addition")}),c},utility:{lookup_method:function(e){return h(e)}},remove:function(){var e=p($(this)),t=$(this);if(!e)return!1;try{f(n.removal,function(n){n(e,t)}),f(n.all,function(n){n(e,"removal",t)})}catch(r){return o("Removal aborted per requested. Given cause: "+r,"E"),!1}e.remove(),f(n["post-removal"],function(e){e(null,t)}),f(n.all,function(e){e(null,"post-removal",t)})},inject:function(e,t,r){var s=!r,r=r||[],u=null;for(u in e){var a=e[u];switch(typeof a){case"string":case"number":d(u,a,t,r);break;case"object":if(isNaN(parseInt(u)))r.push(u),o("Context: "+r),dynamism.inject(a,t,r),r.pop();else{var l=r.join("."),c=null,h=i[l];o("Looking for a factory for "+l);if(h)o("	Using user-defined factory for: "+l),c=h(t,e[u],e);else{o("	Looking for a factory for model: "+l);var p=t.find("[data-dyn-spawn-on='"+l+"'][data-dyn-index=-1]");p.length>0&&(o("		Found "+p.length+"!"),c=$(),p.each(function(){var e=$(this);c=c.add(dynamism.add(e))}))}c&&c.length>0?c.each(function(){var e=$(this);dynamism.inject(a,e,r),e.attr("data-dyn-hook")&&(f(n["post-injection"],function(t){t(e,a)}),f(n.all,function(t){t(e,"post-injection",a)}))}):o("Unable to create model: "+l+", no factory found.","W")}break;default:o("Unknown value type: "+typeof a,"E")}}s&&(o("Invoking all post-injection hooks"),f(n["post-injection"],function(n){n(t,e)}),f(n.all,function(n){n(t,"post-injection",e)}))},bind:function(e){if(!e||$(e).length==0)e=$("*");e.find("[data-dyn-target]:not([data-dyn-action]),[data-dyn-target][data-dyn-action='add']").unbind("click",dynamism.add).bind("click",dynamism.add),e.find("[data-dyn-action='remove']").unbind("click",dynamism.remove).bind("click",dynamism.remove)},hook:function(e){var t=null;try{t=e.find("[data-dyn-hook]:visible")}catch(n){return alert("Unable to inject: "+e+". Cause: "+n)}e.attr("data-dyn-hook")&&(t=t.add(e)),t.each(b)},add_callback:function(e,t){var t=t||"all";if(!e)throw"Undefined "+t+" callback: "+e;if(typeof e!="function")throw"Bad callback type given: "+typeof e;n[t].push(e)},on_addition:function(e){return dynamism.add_callback(e,"addition")},on_removal:function(e){return dynamism.add_callback(e,"removal")},after_removal:function(e){return dynamism.add_callback(e,"post-removal")},after_injection:function(e){return dynamism.add_callback(e,"post-injection")},register_factory:function(e,t){if(i[e])return alert("Seems like you've already registered a factory for: "+e),!1;if(typeof t!="function")return alert("Factory must be a method that creates anobject, given was: "+typeof t+" for model: "+e),!1;i[e]=t,o("Registered factory for: "+e)}}}(),$(function(){$("[data-dyn-entity]:not([data-dyn-index])").attr({"data-dyn-index":-1}),$("[data-dyn-entity][data-dyn-index=-1]").attr({hidden:"true"}),dynamism.after_injection(dynamism.hook);var e=["data-dyn-inject","data-dyn-spawn-on","data-dyn-hook"];dynamism.after_injection(function(t){for(var n=0;n<e.length;++n){var r=e[n];t.find("["+r+"]:visible").attr(r,null),t.attr(r,null)}})});algol=function(){},algol=new algol;algol_ui=function(){function m(){if($(this).parent("[disabled],:disabled,.disabled").length>0)return!1;y($("a.listlike.selected"));var e=$(this).next("ol");return $(this).next("ol").show(),v+e.width()+e.parent().position().left+$(this).position().left>=$(window).width()?e.css({right:0,left:0}):e.css({left:$(this).position().left,right:0}),$(this).addClass("selected"),$(this).unbind("click",m),$(this).add($(window)).bind("click",g),!1}function g(e){return $(this).hasClass("listlike")&&e.preventDefault(),y($(".listlike.selected:visible")),!0}function y(e){return $(e).removeClass("selected"),$(e).next("ol").hide(),$(e).add($(window)).unbind("click",g),$(e).bind("click",m),!0}var e={on_entry:[]},t=null,n={autosave:null,sync:null,flash:null},r="",i=250,s=!1,o=null,u=[],a=2500,f={autosave:30,sync:5,flash:2.5},l={status:1},c={},h={},p={pages:{on_load:[]}},d=[function(){Modernizr.draganddrop||ui.modal.as_alert($("#html5_compatibility_notice"))},function(){dynamism.configure({debug:!1,logging:!1}),$("a[title],span[title]").tooltip({placement:"bottom",delay:{show:500,hide:100}})},function(){$("[data-collapsible]").each(function(){$(this).append($("#collapser").clone().attr({id:null,hidden:null}))})},function(){$("section:not([data-untogglable])").find("> h1:first-child, > h2:first-child, > h3:first-child").addClass("togglable"),$("section > .togglable").click(function(){$(this).siblings(":not([data-untogglable])").toggle(),$(this).toggleClass("toggled")})},function(){$("a[data-disabled], a.disabled").click(function(e){return e.preventDefault(),!1})},function(){$("a.listlike:not(.selected),a[data-listlike]:not(.selected)").bind("click",m)},function(){$("[data-amount]").each(function(){$(this).addClass(parseInt($(this).html())>=0?"positive":"negative")})}],v=120;return{hooks:d,theme:r,action_hooks:p,collapse:function(){var e=$(this);if(e.attr("data-collapse")==null)return e.siblings("[data-collapse]:first").click();e.attr("data-collapsed")?(e.siblings(":not(span.folder_title)").show(),e.attr("data-collapsed",null).html("&minus;"),e.parent().removeClass("collapsed"),pagehub.settings.runtime.cf.pop_value(parseInt(e.attr("data-folder"))),pagehub.settings_changed=!0):(e.siblings(":not(span.folder_title)").hide(),e.attr("data-collapsed",!0).html("&plus;"),e.parent().addClass("collapsed"),pagehub.settings.runtime.cf.push(parseInt(e.attr("data-folder"))),pagehub.settings_changed=!0)},modal:{as_alert:function(e,t){if(typeof e!="string"&&typeof e=="object"){var e=$(e);e.show()}}},status:{clear:function(e){if(!$("#status").is(":visible"))return(e||function(){})();$("#status").addClass("hidden").removeClass("visible"),s=!1,e&&e();if(u.length>0){var t=u.pop();return ui.status.show(t[0],t[1],t[2])}},show:function(e,n,r){n||(n="notice"),r||(r=l.status);if(s&&o!="pending")return u.push([e,n,r]);t&&clearTimeout(t),t=setTimeout("ui.status.clear()",n=="bad"?a*2:a),$("#status").removeClass("pending good bad").addClass(n+" visible").html(e),s=!0,o=n},mark_pending:function(){$(".loader").show()},mark_ready:function(){$(".loader").hide()}},dialogs:{},report_error:function(e){ui.status.show("A script error has occured, please try to reproduce the bug and report it.","bad"),console.log(e)},process_hooks:function(){for(var e=0;e<ui.hooks.length;++e)ui.hooks[e]()}}},ui=new algol_ui,$(function(){for(var e=0;e<ui.hooks.length;++e)ui.hooks[e]()});